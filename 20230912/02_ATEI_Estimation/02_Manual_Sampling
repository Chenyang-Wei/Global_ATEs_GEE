/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var Within = /* color: #ff0000 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([7.672105513657033, 45.792923199368246]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([7.66644637269231, 45.798852063942554]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([7.660517972341441, 45.80100765677817]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([7.659710539214881, 45.80720627258213]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([7.6642916959780205, 45.81448263918598]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([7.807660915908348, 45.80046933495508]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([7.815477336872347, 45.81933484840946]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([7.838113852137427, 45.79265504851632]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Point([7.651624333326201, 45.79912154782638]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Point([7.647583255119219, 45.87188447804647]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Point([7.606350826812629, 45.89883448518808]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Point([7.6055416043308455, 45.893175960215565]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Point([7.555146316995853, 45.849787140135106]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Point([7.557841391733273, 45.85302063974629]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Point([7.551372707529307, 45.84520586475192]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Point([7.545175173965721, 45.84224086084321]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Point([7.544095987022432, 45.84008528479829]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Point([7.545714201612119, 45.83819800612432]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Point([7.547062955716082, 45.83577270456761]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Point([7.551912305871635, 45.82903592727723]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Point([7.538975993202759, 45.8309223044099]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Point([7.514992044430748, 45.84439628134208]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Point([7.514991117692662, 45.848708946432744]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Point([7.503133893284493, 45.83442509807799]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Point([7.507714779442813, 45.83065224763695]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Point([7.431986678531319, 45.83307786547191]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Point([7.39102398245588, 45.82095062746404]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Point([7.3788967387615, 45.816099774008684]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Point([7.371081160094373, 45.81340533770843]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Point([7.524963288801696, 45.92255062526802]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8154502583932297, 42.63687207073881]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8111385375621358, 42.62824905422956]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8079038872556508, 42.62555251306722]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Point([1.806017894322265, 42.61908542357283]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8054794645210404, 42.6150428908763]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Point([1.802783753938484, 42.60507146562216]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8025148452618378, 42.602646992648296]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8011677063020137, 42.60129952073193]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8008986014111228, 42.59806521054767]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Point([1.810599579499197, 42.653041686122826]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "39"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8041309706329267, 42.6471132215136]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "40"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8940486710173978, 42.94382619738967]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "41"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8883898273965052, 42.94086143316749]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "42"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8757224103462802, 42.943826680068995]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "43"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8309861442192656, 42.90987038466336]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "44"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8223628780192027, 42.90663609291964]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "45"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8285607820078389, 42.90097702569155]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "46"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8401498519684014, 42.90717505064309]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "47"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6911189746212454, 42.9532593456]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "48"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6892326116446834, 42.949216341028006]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "49"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.7156434685339841, 42.896934316755534]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "50"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6657856926926664, 42.8939710552651]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "51"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6105406648474121, 42.895317159018994]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "52"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5927551177372403, 42.89531855431461]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "53"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5938313973317078, 42.89181423894871]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "54"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6046130229010016, 42.887771906131576]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "55"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6126954950083374, 42.872141173065685]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "56"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6153916367835555, 42.8659435474078]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "57"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6207817360824719, 42.851929289945396]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "58"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6159298545700742, 42.84788634732965]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "59"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6083845498102414, 42.84761618844417]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "60"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6046111129922505, 42.85111975005268]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "61"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5976035978896643, 42.84761649948405]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "62"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5962562486644951, 42.84546102428432]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "63"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5938318910216167, 42.841958041429685]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "64"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5924832781008993, 42.84060967467422]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "65"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5876325975401797, 42.8419578142586]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "66"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5736181179155686, 42.85354534809606]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "67"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5736187049909169, 42.85085030696941]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "68"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5733508763622619, 42.84923389561023]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "69"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5714630797400977, 42.846000355040246]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "70"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5746967221248167, 42.84087912156186]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "71"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5763138989682548, 42.837106525623135]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "72"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5755056052548535, 42.834141595734756]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "73"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5860153203974727, 42.819319648333384]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "74"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5870933734230421, 42.81662481978598]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "75"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5903270764243129, 42.814199303073174]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "76"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5949096116299524, 42.811504745284246]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "77"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5989519322865178, 42.806384483045]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "78"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5905971654486986, 42.80368870563548]),
            {
              "Class": "Within",
              "Type": 2,
              "system:index": "79"
            })]),
    Above = /* color: #0000ff */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([7.6589009933760765, 45.8204115856065]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([7.657822774471037, 45.81744649504629]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([7.654588760616643, 45.813134351514705]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([7.592335363894032, 45.900722154799254]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([7.805234799228673, 45.8185251715381]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([7.7979605054927426, 45.79966091954038]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([7.8513203716350155, 45.7934623685067]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([7.543288174419542, 45.84574418288592]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Point([7.540592953567642, 45.84493433044524]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Point([7.658632302007882, 45.87080725935242]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Point([7.525232266331265, 45.844666928980836]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Point([7.497743647242139, 45.82795773826062]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Point([7.399378022228351, 45.82418459590715]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Point([7.399647809132888, 45.820680693982744]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Point([7.424709723364993, 45.828227202586994]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Point([1.7979331478467753, 42.615851231756004]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Point([1.7963154816327132, 42.604802198080066]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Point([1.7936200486951837, 42.60264689149841]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Point([1.7957783260776372, 42.600490315617584]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Point([1.800898090120353, 42.617738206969285]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8054795885950314, 42.653041133985]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8019744948302785, 42.65061613085058]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8851548575297019, 42.94625176950036]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8819214579771573, 42.94382609035252]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8323338606283182, 42.90636612952955]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6194334393058654, 42.872950939367094]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6221284171130415, 42.86971621667259]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6471919962984618, 42.86082296968978]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6102721921419851, 42.89073696245962]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6714449841179926, 42.891814996513205]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.7272322915857732, 42.8963963184581]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.7239961508258475, 42.89154579541864]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6048814079765252, 42.84222676711211]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.598142845117795, 42.834951138237074]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5881715672503418, 42.8368371819896]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5800874807187717, 42.831986967796986]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5792774544642798, 42.829022092221386]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6008394786359195, 42.81878202330079]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5981429256893045, 42.81474007757892]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6081161868334206, 42.80827163385653]),
            {
              "Class": "Above",
              "Type": 1,
              "system:index": "39"
            })]),
    Below = /* color: #00ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([7.669950972713977, 45.81044041717016]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([7.666985676296845, 45.805588841608234]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Point([7.670220448566729, 45.80289527686812]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Point([7.640844417341461, 45.791575692162056]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Point([7.631950331710997, 45.810171852084]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Point([7.641382604060172, 45.87188445527736]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Point([7.616861248528388, 45.88940279887195]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Point([7.628986988588391, 45.86595627026144]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Point([7.559996020798598, 45.82957450817989]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Point([7.615783081404128, 45.88293491052331]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Point([7.533585614232856, 45.82876577854098]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Point([7.521458062455957, 45.82795705460513]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Point([7.373775974865544, 45.822567650779675]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Point([7.365690523421051, 45.820950765152695]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Point([7.363535493755373, 45.81717809998319]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8127552899322374, 42.64441871779581]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8119463522415247, 42.62447568849377]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8405133462063272, 42.632830299088354]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Point([1.8356625948175243, 42.62555245922886]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8900045872723372, 42.93735823109446]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8962040097056834, 42.93169978088302]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "20"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8759920078043981, 42.937629866842734]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "21"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.825596394975654, 42.91337409156955]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "22"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8212849961436874, 42.91094811986]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "23"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.8126614064603643, 42.89558609395624]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "24"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.7151056301617054, 42.90205538995141]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "25"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5903278017922786, 42.897203273242454]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "26"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6143139939718489, 42.862169462155926]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "27"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.6059588527352577, 42.857858412492995]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "28"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5962571810014228, 42.86648212087923]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "29"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5930223838321158, 42.860822304218]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "30"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5951780609448898, 42.855701649732566]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "31"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5830524908639778, 42.85543158936076]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "32"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5795477988008968, 42.85974373321903]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "33"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5679611027446074, 42.85462388672233]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "34"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5717323214212078, 42.83575973236445]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "35"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5690374760855454, 42.82983040345542]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "36"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5825130966813585, 42.81743362370198]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "37"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.566613214272631, 42.85139103957934]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "38"
            }),
        ee.Feature(
            ee.Geometry.Point([-0.5679598035597677, 42.82659720275533]),
            {
              "Class": "Below",
              "Type": 3,
              "system:index": "39"
            })]),
    focus = /* color: #00ffff */ee.Geometry.Point([-0.5876121981612337, 42.80373096293646]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/

/**
 * Introduction:
 * 
 *  1) Mannually collect points of the three classes
 *    in the climatic ATE (i.e., "new CATE").
 * 
 *  2) Extract a 30-m pixel at each sample point.
 * 
 *  3) Generate a 300-m buffer at each sample point.
 * 
 * Runtime: < 1m (shared).
 * 
 * Update: 5/24/2023.
*/


/* Load module(s). */
var IMG = require("users/ChenyangWei/Public:Modules/General/Image_Analysis&Processing.js");
var ATEI_EA = require("users/ChenyangWei/Public:Modules/Treeline/ATEI_Estimation&Analysis.js");
var GATE = require("users/ChenyangWei/Public:Modules/Treeline/Global_ATE.js");
var TNA = require("users/ChenyangWei/Public:Modules/Treeline/Transect_NDVI_Analysis.js");
var VIS = require("users/ChenyangWei/Public:Modules/General/Visualization.js");


/* Object definition. */

// Determine the continent ID (0 ~ 5).
var contID = 4;

// Determine the target projection.
var targetPrj = IMG.WGS84_30m;

// Create a list of the working directories.
var WDs_List = ATEI_EA.WDs_AllContinents_List;

// Define a list of the AOIs.
var AOIs_List = ATEI_EA.AOIs_AllContinents_List;

// Generate a median reducer.
var medianReducer = ee.Reducer.median();

// Load the ALOS elevation.
var rawElv = ee.ImageCollection('JAXA/ALOS/AW3D30/V3_2').select('DSM')
  .mosaic()
  .reproject(targetPrj);

// Define a circular kernel of 10 pixels.
var Kn_10pxCir = ee.Kernel.circle({
  radius: 10,
  units: "pixels"
}); 


/* Function definition. */

// Define a function to load and reproject the new CATE 
//  of each continent.
var Read_NewCATE = function(wd_Cont) {
  var newCATE_Cont = ee.Image(wd_Cont
    + "Climate-Based_ATE/" 
    + GATE.newCATE_fileName)
    .reproject(targetPrj);
  
  return newCATE_Cont;
};

// Define a function to calculate the temporal median NDVIs of 
//  the new CATE in continents other than North America.
var Calculate_MedianNDVI = function(wd_Cont, newCATE_Cont) {
  var medianNDVI_Cont = TNA.loadAnnualNDVIs_nonNorthAmerica(wd_Cont)
    .updateMask(newCATE_Cont)
    .reduce(medianReducer)
    .reproject(targetPrj)
    .rename("medianNDVI");
  
  return medianNDVI_Cont;
};

// Define a function to load the 3-km smoothed
//  non-forested NDVI of each continent.
var Read_SmdNonfNDVI_3km = function(wd_Cont) {
  var smdNonfNDVI_Cont = ee.Image(wd_Cont
    + "ATEI_Estimation/NonForestedNDVI/" 
    + "3kmSmoothed_NonForestedNDVI_NewCATE");
  
  return smdNonfNDVI_Cont;
};

// Define a function to load the 3-km smoothed
//  open-forest NDVI of each continent.
var Read_SmdOpenfNDVI_3km = function(wd_Cont) {
  var smdOpenfNDVI_Cont = ee.Image(wd_Cont
    + "ATEI_Estimation/OpenForestNDVI/" 
    + "3kmSmoothed_OpenForestNDVI_NewCATE");
  
  return smdOpenfNDVI_Cont;
};

// Define a function to load the 3-km smoothed
//  closed-forest NDVI of each continent.
var Read_SmdClsdfNDVI_3km = function(wd_Cont) {
  var smdClsdfNDVI_Cont = ee.Image(wd_Cont
    + "ATEI_Estimation/ClosedForestNDVI/" 
    + "3kmSmoothed_ClosedForestNDVI_NewCATE");
  
  return smdClsdfNDVI_Cont;
};

// Define a Gaussian function.
var gauss_Fun = function(x_Img, b_Img, c_Img) {
  
  var base_Img = x_Img.subtract(b_Img).divide(c_Img);
  
  var gauss_Img = base_Img.pow(2).multiply(-1 / 2).exp()
    // .rename("gauss_NDVI")
    .reproject(targetPrj);
  
  return gauss_Img;
};

// Define a function to transform the gradient magnitude.
var k_Value = 13131.49;
var x_0 = 0.000649;

var mag_Fun = function(mag_Value) {
  
  var power = mag_Value.subtract(x_0).multiply(-1 * k_Value);
  
  var comp_Mag = ee.Image(1).divide(power.exp().add(1))
    // .rename("comp_Mag")
    .reproject(targetPrj);
  
  return comp_Mag;
};

// Define a function to determine the gradient angle.
var p_Value = 17.89181;

var angle_Fun = function(angle_Value) {
  
  var cos_Value = angle_Value.cos();
  
  var base = ee.Image(1).subtract(cos_Value).divide(2);
  
  var comp_Angle = base.pow(p_Value)
    // .rename("comp_Angle")
    .reproject(targetPrj);
  
  return comp_Angle;
};


// Define a function to create a 300-m buffer 
//  around each sample point.
var Create_SampleBuffer = function(samplePt_Ftr) {
  var keepProperties = ["Class", "Type"];
  
  var sampleBuffer_Ftr = samplePt_Ftr.buffer(300)
    .copyProperties({
      source: samplePt_Ftr, 
      properties: keepProperties
    });
  
  return sampleBuffer_Ftr;
};


/* Acquire the information of the continent. */

// Determine the working directory of the continent.
var contWD = WDs_List[contID];

// Determine the AOI of the continent.
var contAOI = AOIs_List[contID];


/* Read the new CATE. */

var newCATE = Read_NewCATE(contWD);


/* Pre-process the elevation dataset. */

// Calculate the focal "median" within the kernel
//  (same as the NDVI smoothing metric).
var medSmd_Elv = rawElv.reduceNeighborhood({
  reducer: medianReducer,
  kernel: Kn_10pxCir,
  skipMasked: true
  // Mask output pixels if 
  //  the corresponding input pixels are masked.
}).reproject(targetPrj);

// Compute the elevation gradient.
var medElv_Grad = medSmd_Elv.gradient()
  .reproject(targetPrj);

// Derive the direction of the elevation gradient.
var medElv_Dir = medElv_Grad.select("y")
  .atan2(medElv_Grad.select("x"))
  .reproject(targetPrj)
  .rename("medElv_Dir");



/* Read the 3-km smoothed NDVIs worldwide. */

var smdNonfNDVI_3km = Read_SmdNonfNDVI_3km(contWD);

var smdOpenfNDVI_3km = Read_SmdOpenfNDVI_3km(contWD);

var smdClsdfNDVI_3km = Read_SmdClsdfNDVI_3km(contWD);


/* Determine the smaller NDVI difference at each pixel. */

var Non_Open_Diff = smdNonfNDVI_3km
  .subtract(smdOpenfNDVI_3km)
  .abs();

var Clsd_Open_Diff = smdClsdfNDVI_3km
  .subtract(smdOpenfNDVI_3km)
  .abs();

var smaller_NDVIdiff = Clsd_Open_Diff.where(
  Non_Open_Diff.lt(Clsd_Open_Diff), 
  Non_Open_Diff);



/* Calculate the temporal median NDVI of 
  the closed forests during 2015-2019 . */

if (contID === 0) {
  // Calculate the temporal median NDVI in North America.
  var medianNDVI = ee.Image(GATE.wd_NorthAmerica
    + "ATEI_Estimation/"
    + TNA.annualMaxNDVI_300mBufNewCATE_NorthAmerica_fileName)
    .updateMask(newCATE)
    .reduce(medianReducer)
    .reproject(targetPrj)
    .rename("medianNDVI");
  
} else if (contID === 5) {
  // Calculate the temporal median NDVI in Asia 
  //  (using a different working directory).
  var medianNDVI = Calculate_MedianNDVI(
    GATE.wd_Asia_2, newCATE);
  
} else {
  // Calculate the temporal median NDVI in other continents.
  var medianNDVI = Calculate_MedianNDVI(
    contWD, newCATE);
}

// Compute the NDVI gradient.
var NDVI_grad = medianNDVI.gradient()
  .reproject(targetPrj);

// Determine the direction of the NDVI gradient.
var NDVI_dir = NDVI_grad.select("y")
  .atan2(NDVI_grad.select("x"))
  .reproject(targetPrj)
  .rename("NDVI_dir");

// Derive the magnitude of the NDVI gradient.
var NDVI_mag = NDVI_grad.select("y")
  .hypot(NDVI_grad.select("x"))
  .reproject(targetPrj)
  .rename("NDVI_mag");

// Calculate the absolute angle between the NDVI and elevation gradients.
var dir_Angle = NDVI_dir.subtract(medElv_Dir).abs();


/* Test the "temporary" ATEI. */

// "Gradient Magnitude" component.
var comp_Mag = mag_Fun(NDVI_mag);

// "Gradient Angle" component.
var comp_Angle = angle_Fun(dir_Angle);

// "Gaussian" component.
var gauss_NDVI = gauss_Fun(
  medianNDVI, 
  smdOpenfNDVI_3km, 
  smaller_NDVIdiff.divide(2));

// Combine the components.
var combined_Components = gauss_NDVI.multiply(comp_Mag)
  .multiply(comp_Angle)
  .rename("combined_Components")
  .reproject(targetPrj);

// Fit a logistic regression.
var logit_Formula = "-0.34458 + " 
  + "23.76459 * combined_Components";

var logit = combined_Components.expression({
  expression: logit_Formula,
  map: {
    combined_Components: combined_Components
      .select("combined_Components")
  }
}); 

var exp_Logit = logit.exp();

var ATEI = exp_Logit.divide(exp_Logit.add(1))
  .rename("ATEI");


/* Generate a 300-m buffer at each sample point. */

// Combine all types of sampled points.
var samplePts = Above.merge(Within).merge(Below);

// Generate a buffer zone around each sample point.
var sampleBuffers = ee.FeatureCollection(
  samplePts.map(Create_SampleBuffer));


/* Convert sample points to 30-m pixels. */

// Create an image for each type of 
//  sample points.
var abovePx = ee.Image(1).byte()
  .clipToCollection(Above);

var withinPx = ee.Image(2).byte()
  .clipToCollection(Within);

var belowPx = ee.Image(3).byte()
  .clipToCollection(Below);

// Combine the three types of sample pixels.
var samplePixels = ee.ImageCollection.fromImages([
  abovePx, withinPx, belowPx
  ]).mosaic()
  .reproject(targetPrj)
  .rename("Type");

// Create a background pixel for each sample point.
var backgroundPixels = ee.Image(0).byte()
  .clipToCollection(samplePts)
  .reproject(targetPrj);

// Create a 30-m random image as a reference.
var randomImg_30m = ee.Image.random({
  seed: 17, 
  distribution: "uniform"
}).updateMask(newCATE)
  .reproject(targetPrj);

// Create a 15-m random image as a reference.
var randomImg_15m = ee.Image.random({
  seed: 17, 
  distribution: "uniform"
}).updateMask(newCATE)
  .reproject({
  crs: "EPSG:4326",
  scale: 15
});


if (false) {
  
  IMG.printImgInfo("samplePixels", samplePixels);
  
  print("samplePts", samplePts.first(), 
    samplePts.size());
  
  print("sampleBuffers", sampleBuffers.first(), 
    sampleBuffers.size());

  // Visualize the datasets.
  Map.setOptions("satellite");
  
  // Map.centerObject(contAOI, 6);
  Map.centerObject(focus, 15);
  
  Map.addLayer(medianNDVI, VIS.NDVI_vis, 
    "NDVI", false, 1);
  
  Map.addLayer(randomImg_30m.randomVisualizer(), 
    {}, 
    "30 m", false, 0.5);
  
  Map.addLayer(randomImg_15m.randomVisualizer(), 
    {}, 
    "15 m", false, 1);
  
  Map.addLayer(newCATE, {palette: "FFFFFF"}, 
    "CATE", false, 0.5);
  
  Map.addLayer(ATEI.updateMask(ATEI.gt(0.5)), 
    {palette: "FFFFFF"}, 
    "ATEI > 0.5 (White)", false, 0.5);
  
  Map.addLayer(ATEI.updateMask(ATEI.gt(0.5)), 
    {palette: "0000FF"}, 
    "ATEI > 0.5 (Blue)", false, 0.5);
  
  Map.addLayer(sampleBuffers, {color: "FFFFFF"}, 
    "Buffer", true, 0.5);
  
  // Map.addLayer(backgroundPixels, 
  //   {palette: "FFFFFF"}, 
  //   "Grey", false, 0.3);
  
  Map.addLayer(samplePixels, 
    {min: 1, max: 3, palette: "0000FF, FF0000, 00FF00"}, 
    "Sample", false, 0.3);
  
} else {
  
  /* Output the sampling result to Asset. */
  
  // Define a function to add the region name 
  //  to each sample point.
  var regionName = "Europe";
  
  var Add_RegionName = function(samplePt_Ftr) {
    var samplePt_withRegion_Ftr = samplePt_Ftr
      .set({
        Region: regionName
      });
    
    return samplePt_withRegion_Ftr;
  };

  // Add the region name to each sample point.
  var samplePts_withRegionName = ee.FeatureCollection(
    samplePts.map(Add_RegionName));

  if (false) { // true OR false.
  
    print(contWD);
    
    print("samplePts_withRegionName", 
      samplePts_withRegionName.first(), 
      samplePts_withRegionName.size());
  }
  
  var fileName = "manuallySampledPoints";
  
  Export.table.toAsset({
    collection: samplePts_withRegionName, 
    description: fileName, 
    assetId: contWD
      + "ATEI_Estimation/"
      + fileName
  });
}

